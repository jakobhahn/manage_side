# SumUp Integration Types

Die Hans Restaurant App unterst√ºtzt zwei verschiedene Arten der SumUp-Integration:

## üîë API Key Integration

Die **API Key Integration** ist die einfachste Methode zur Integration mit SumUp.

### Vorteile:
- ‚úÖ Einfache Einrichtung
- ‚úÖ Direkte API-Zugriffe
- ‚úÖ Keine OAuth-Token-Verwaltung

### Nachteile:
- ‚ö†Ô∏è Weniger sicher als OAuth
- ‚ö†Ô∏è API-Keys m√ºssen manuell verwaltet werden

### Einrichtung:
1. Gehe zu deinem SumUp Developer Dashboard
2. Erstelle einen neuen API Key
3. Kopiere den API Key und API Secret
4. F√ºge diese in der Hans App unter "SumUp Integration" hinzu

## üîê OAuth Integration

Die **OAuth Integration** bietet eine sicherere Methode zur Integration mit SumUp.

### Vorteile:
- ‚úÖ H√∂here Sicherheit
- ‚úÖ Automatische Token-Erneuerung
- ‚úÖ Bessere Kontrolle √ºber Berechtigungen

### Nachteile:
- ‚ö†Ô∏è Komplexere Einrichtung
- ‚ö†Ô∏è Erfordert OAuth-Flow-Implementierung

### Einrichtung:
1. Gehe zu deinem SumUp Developer Dashboard
2. Erstelle eine neue OAuth-Anwendung
3. Kopiere die Client ID und Client Secret
4. F√ºge diese in der Hans App unter "SumUp Integration" hinzu

## üõ†Ô∏è Technische Details

### Datenbankstruktur

Die `merchant_codes` Tabelle unterst√ºtzt beide Integrationstypen:

```sql
CREATE TYPE integration_type AS ENUM ('oauth', 'api_key');

ALTER TABLE public.merchant_codes 
ADD COLUMN integration_type integration_type DEFAULT 'api_key',
ADD COLUMN oauth_client_id VARCHAR(255),
ADD COLUMN oauth_client_secret_encrypted TEXT,
ADD COLUMN oauth_access_token_encrypted TEXT,
ADD COLUMN oauth_refresh_token_encrypted TEXT,
ADD COLUMN oauth_token_expires_at TIMESTAMP WITH TIME ZONE,
ADD COLUMN api_key_encrypted TEXT,
ADD COLUMN api_secret_encrypted TEXT,
ADD COLUMN encryption_salt VARCHAR(255);
```

### Verschl√ºsselung

Alle sensiblen Daten werden mit AES-256-CBC verschl√ºsselt:

- **API Keys**: Verschl√ºsselt mit zuf√§lligem IV
- **OAuth Secrets**: Verschl√ºsselt mit zuf√§lligem IV
- **Salt**: Wird f√ºr zus√§tzliche Sicherheit verwendet

### API-Endpunkte

#### Merchant Codes erstellen
```http
POST /api/merchant-codes
Content-Type: application/json
Authorization: Bearer <token>

{
  "merchant_code": "JOSCHI001",
  "description": "Main Restaurant POS",
  "integration_type": "api_key", // oder "oauth"
  "api_key": "your-api-key",     // f√ºr API Key Integration
  "api_secret": "your-api-secret", // f√ºr API Key Integration
  "oauth_client_id": "your-client-id", // f√ºr OAuth Integration
  "oauth_client_secret": "your-client-secret" // f√ºr OAuth Integration
}
```

#### Merchant Codes abrufen
```http
GET /api/merchant-codes
Authorization: Bearer <token>
```

Die Antwort enth√§lt den `integration_type` und relevante Felder basierend auf dem Typ.

## üîÑ Migration von API Key zu OAuth

Um von API Key zu OAuth zu wechseln:

1. Erstelle eine neue OAuth-Anwendung in SumUp
2. F√ºge die OAuth-Credentials in der Hans App hinzu
3. Teste die neue Integration
4. Deaktiviere die alte API Key Integration

## üö® Sicherheitshinweise

- **Niemals** API Keys oder OAuth Secrets im Klartext speichern
- Verwende immer die Verschl√ºsselung der Hans App
- Rotiere regelm√§√üig deine API Keys
- √úberwache die API-Nutzung in deinem SumUp Dashboard

## üìû Support

Bei Fragen zur SumUp-Integration:

1. √úberpr√ºfe die [SumUp API-Dokumentation](https://developer.sumup.com/)
2. Kontaktiere den Hans Support
3. √úberpr√ºfe die Logs in der Hans App f√ºr Fehlerdetails
