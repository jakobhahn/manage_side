# API Reference

This document provides comprehensive documentation for the Hans Restaurant App API endpoints.

## Base URL

```
Production: https://hans-restaurant-app.vercel.app/api
Development: http://localhost:3000/api
```

## Authentication

All API endpoints require authentication unless otherwise specified. Include the JWT token in the Authorization header:

```http
Authorization: Bearer <your-jwt-token>
```

## Response Format

All API responses follow a consistent format:

```typescript
interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: {
    code: string;
    message: string;
    details?: any;
  };
  meta?: {
    pagination?: {
      page: number;
      limit: number;
      total: number;
      totalPages: number;
    };
  };
}
```

## Error Codes

| Code | Description |
|------|-------------|
| `UNAUTHORIZED` | Invalid or missing authentication token |
| `FORBIDDEN` | Insufficient permissions for the requested action |
| `NOT_FOUND` | Resource not found |
| `VALIDATION_ERROR` | Request validation failed |
| `CONFLICT` | Resource already exists or conflict occurred |
| `INTERNAL_ERROR` | Server error occurred |

## Authentication Endpoints

### Login

```http
POST /api/auth/login
```

**Request Body:**
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "user": {
      "id": "uuid",
      "email": "user@example.com",
      "name": "John Doe",
      "role": "manager"
    },
    "token": "jwt-token"
  }
}
```

### Register

```http
POST /api/auth/register
```

**Request Body:**
```json
{
  "email": "user@example.com",
  "password": "password123",
  "name": "John Doe",
  "role": "staff"
}
```

### Logout

```http
POST /api/auth/logout
```

## Menu Management

### Get Menu Items

```http
GET /api/menu
```

**Query Parameters:**
- `category` (optional): Filter by category
- `available` (optional): Filter by availability (true/false)
- `page` (optional): Page number for pagination
- `limit` (optional): Items per page (default: 20)

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "name": "Margherita Pizza",
      "description": "Classic tomato and mozzarella",
      "price": 12.99,
      "category": "pizza",
      "available": true,
      "image_url": "https://example.com/pizza.jpg"
    }
  ],
  "meta": {
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 45,
      "totalPages": 3
    }
  }
}
```

### Create Menu Item

```http
POST /api/menu
```

**Request Body:**
```json
{
  "name": "New Pizza",
  "description": "Delicious new pizza",
  "price": 15.99,
  "category": "pizza",
  "available": true
}
```

### Update Menu Item

```http
PUT /api/menu/:id
```

### Delete Menu Item

```http
DELETE /api/menu/:id
```

## Order Management

### Get Orders

```http
GET /api/orders
```

**Query Parameters:**
- `status` (optional): Filter by order status
- `table_id` (optional): Filter by table
- `date` (optional): Filter by date (YYYY-MM-DD)
- `page` (optional): Page number
- `limit` (optional): Orders per page

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "table_id": "uuid",
      "user_id": "uuid",
      "status": "pending",
      "total": 25.98,
      "items": [
        {
          "id": "uuid",
          "menu_item_id": "uuid",
          "quantity": 2,
          "price": 12.99,
          "menu_item": {
            "name": "Margherita Pizza"
          }
        }
      ],
      "created_at": "2024-01-15T10:30:00Z",
      "updated_at": "2024-01-15T10:30:00Z"
    }
  ]
}
```

### Create Order

```http
POST /api/orders
```

**Request Body:**
```json
{
  "table_id": "uuid",
  "items": [
    {
      "menu_item_id": "uuid",
      "quantity": 2
    }
  ]
}
```

### Update Order Status

```http
PUT /api/orders/:id/status
```

**Request Body:**
```json
{
  "status": "preparing"
}
```

**Order Statuses:**
- `pending` - Order received
- `preparing` - Being prepared in kitchen
- `ready` - Ready for pickup
- `served` - Delivered to table
- `cancelled` - Order cancelled

### Get Order Items

```http
GET /api/orders/:id/items
```

## Table Management

### Get Tables

```http
GET /api/tables
```

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "number": "1",
      "capacity": 4,
      "status": "available",
      "current_order": null
    }
  ]
}
```

### Update Table Status

```http
PUT /api/tables/:id/status
```

**Request Body:**
```json
{
  "status": "occupied"
}
```

**Table Statuses:**
- `available` - Table is free
- `occupied` - Table has customers
- `reserved` - Table is reserved
- `cleaning` - Table is being cleaned

## Reservation Management

### Get Reservations

```http
GET /api/reservations
```

**Query Parameters:**
- `date` (optional): Filter by date (YYYY-MM-DD)
- `status` (optional): Filter by status
- `table_id` (optional): Filter by table

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "user_id": "uuid",
      "table_id": "uuid",
      "date_time": "2024-01-15T19:00:00Z",
      "party_size": 4,
      "status": "confirmed",
      "customer_name": "John Doe",
      "customer_phone": "+1234567890",
      "special_requests": "Birthday celebration"
    }
  ]
}
```

### Create Reservation

```http
POST /api/reservations
```

**Request Body:**
```json
{
  "table_id": "uuid",
  "date_time": "2024-01-15T19:00:00Z",
  "party_size": 4,
  "customer_name": "John Doe",
  "customer_phone": "+1234567890",
  "special_requests": "Birthday celebration"
}
```

### Update Reservation

```http
PUT /api/reservations/:id
```

### Cancel Reservation

```http
DELETE /api/reservations/:id
```

## Analytics Endpoints

### Get Sales Analytics

```http
GET /api/analytics/sales
```

**Query Parameters:**
- `start_date` (required): Start date (YYYY-MM-DD)
- `end_date` (required): End date (YYYY-MM-DD)
- `group_by` (optional): Group by day, week, or month

**Response:**
```json
{
  "success": true,
  "data": {
    "total_revenue": 1250.50,
    "total_orders": 45,
    "average_order_value": 27.79,
    "daily_breakdown": [
      {
        "date": "2024-01-15",
        "revenue": 250.50,
        "orders": 8
      }
    ]
  }
}
```

### Get Popular Items

```http
GET /api/analytics/popular-items
```

**Query Parameters:**
- `start_date` (required): Start date
- `end_date` (required): End date
- `limit` (optional): Number of items to return

## WebSocket Events

The API also supports real-time updates via WebSocket connections:

### Connection

```javascript
const ws = new WebSocket('wss://hans-restaurant-app.vercel.app/ws');
```

### Events

#### Order Updates
```json
{
  "type": "order_update",
  "data": {
    "order_id": "uuid",
    "status": "ready",
    "table_id": "uuid"
  }
}
```

#### Table Status Changes
```json
{
  "type": "table_update",
  "data": {
    "table_id": "uuid",
    "status": "occupied"
  }
}
```

#### New Reservations
```json
{
  "type": "reservation_created",
  "data": {
    "reservation_id": "uuid",
    "table_id": "uuid",
    "date_time": "2024-01-15T19:00:00Z"
  }
}
```

## Rate Limiting

API endpoints are rate limited to prevent abuse:

- **Authentication endpoints**: 5 requests per minute
- **Read operations**: 100 requests per minute
- **Write operations**: 20 requests per minute

Rate limit headers are included in responses:
```http
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1640995200
```

## SDK Examples

### JavaScript/TypeScript

```typescript
import { HansApiClient } from '@hans/api-client';

const client = new HansApiClient({
  baseUrl: 'https://hans-restaurant-app.vercel.app/api',
  token: 'your-jwt-token'
});

// Get menu items
const menu = await client.menu.getItems({
  category: 'pizza',
  available: true
});

// Create order
const order = await client.orders.create({
  table_id: 'uuid',
  items: [
    { menu_item_id: 'uuid', quantity: 2 }
  ]
});
```

### cURL Examples

```bash
# Login
curl -X POST https://hans-restaurant-app.vercel.app/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"user@example.com","password":"password123"}'

# Get menu items
curl -X GET https://hans-restaurant-app.vercel.app/api/menu \
  -H "Authorization: Bearer your-jwt-token"

# Create order
curl -X POST https://hans-restaurant-app.vercel.app/api/orders \
  -H "Authorization: Bearer your-jwt-token" \
  -H "Content-Type: application/json" \
  -d '{"table_id":"uuid","items":[{"menu_item_id":"uuid","quantity":2}]}'
```

## Testing

Use our Postman collection for testing the API:

[Download Postman Collection](./api-collection.json)

Or use the interactive API documentation at `/api/docs` when running the development server.
